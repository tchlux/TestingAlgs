This version is the first implementation that reproduces the same
output as the original Matlab code. It is very inefficient. There are
at least one or two bugs remaining (that I didn't find until the next
version) so no speed gains over Matlab are presented here.
