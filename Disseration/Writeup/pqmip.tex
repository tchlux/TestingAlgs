\documentclass{article}


%% Get access to mathematical symbols.
\usepackage{amssymb}
%% Get access to the \rightarrow command.
\usepackage{amsmath}
%% Use color links to make them clickable and easy to see.
\usepackage[colorlinks,allcolors=blue]{hyperref}
%% Set the font size of Section headers to be different.
\usepackage{sectsty}
\sectionfont{\fontsize{12}{15}\selectfont}
%% 

\begin{document}

\title{Algorithm for Constructing Piecewise Quintic \\ Monotone Interpolating Splines}
\author{Thomas C.H. Lux}
\maketitle

\subsection*{Forward}

When provided data that has no assigned first and second derivative values, the derivative data is filled by a linear fit of neighboring data points. End points are set to be the slope between the end and its nearest neighbor.

The method for finding the transition point of a boolean function on a line is the Golden Section search. This will be referred to in pseudo code as \texttt{line\_search($g,$ $a,$ $b$)} where $a,$ $b$ $\in S$ for $S$ closed under convex combination, $g: S \rightarrow \{0,1\}$ is a boolean function, and $g(b) = 1$. If $g(a) = 1$ then $a$ is returned, otherwise the smallest $c \in [0,1]$ such that $g\big(a(1-c) + c b\big) = 1$ is returned.

After assigning function values and derivative values, an interpolating function is constructed from a quintic B-spline basis.

\vspace{10pt}

%% ----------------------------------------------------------------------

\section{Verifying Monotonicity of a Quintic Polynomial}
\label{is_monotone}
Let $f$ be a quintic polynomial over a closed interval $[x_0, x_1]$ $\subset \mathbb{R}$. Now $f$ is uniquely defined by the evaluation tuples $\big(x_0,$ $f(x_0),$ $f'(x_0),$ $f''(x_0)\big)$ and $\big(x_1,$ $f(x_1),$ $f'(x_1),$ $f''(x_1)\big).$ Assume without loss of generality that $f(x_0) < f(x_1),$ where the case of monotonic decreasing $f$ would consider the negated the function values. The following algorithm will determine whether or not $f$ is monotone increasing on the interval $[x_0, x_1].$

\vspace{10pt}
\hrule
\vspace{3pt}
\noindent\textbf{\textit{Algorithm 1a:}} \texttt{is\_monotone}
\vspace{3pt}
\hrule

\begin{itemize}
  \itemsep0pt
  \parskip0pt

\item[0:] \texttt{if $\big(f'(x_0) = 0$ or $f'(x_1) = 0\big)$ return is\_monotone\_simplified}
\item[1:] \texttt{if $\big(f'(x_0) < 0$ or $f'(x_1) < 0\big)$ return FALSE}
  \begin{itemize}
    \item[] \textit{This can be seen clearly from the fact that $f$ is analytic; there will exist some nonempty ball about $x_0$ or $x_1$ on which $f$ is decreasing.}
  \end{itemize}

\item[2:] $A = f'(x_0)\frac{x_1 - x_0}{f(x_1) - f(x_0)}$
\item[3:] $B = f'(x_1) \frac{x_1 - x_0}{f(x_1) - f(x_0)}$
  \begin{itemize}
    \item[] \textit{The variables $A$ and $B$ correspond directly to the theoretical foundation for positive quartic polynomials established in \cite{ulrich1994positivity}, first defined after equation 18.}
  \end{itemize}
\item[8:] $\gamma_0 = 4 \frac{f'(x_0)}{f'(x_1)} (B/A)^{3/4}$
\item[9:] $\gamma_1 = \frac{x_1 - x_0}{f'(x_1)} (B/A)^{3/4}$
\item[4:] $\alpha_0 = 4 (B/A)^{1/4}$
\item[5:] $\alpha_1 = -\frac{x_1 - x_0}{f'(x_1)} (B/A)^{1/4}$
\item[6:] $\beta_0 = 30 - \frac{12 \big(f'(x_0) + f'(x_1)\big) (x_1 - x_0)}{\big(f(x_1) - f(x_0)\big) \sqrt{A}\sqrt{B}}$
\item[7:] $\beta_1 = \frac{-3 (x_1 - x_0)^2}{2 \big(f(x_1) - f(x_0)\big) \sqrt{A} \sqrt{B}} $
  \begin{itemize}
    \item[] \textit{The $\gamma,$ $\alpha,$ and $\beta$ terms with subscripts $0$ and $1$ are algebraic reductions of the simplified conditions for satisfying Theorem 2 in \cite{ulrich1994positivity} (equation 16). These terms with subscripts $0$ and $1$ give the computation of $\alpha,$ $\beta,$ and $\gamma$ the form seen in lines $10$-$12$ below.}
  \end{itemize}
\item[10:] $\gamma = \gamma_0 + \gamma_1 f''(x_0)$
\item[11:] $\alpha = \alpha_0 + \alpha_1 f''(x_1)$
\item[12:] $\beta = \beta_0 + \beta_1 \big(f''(x_0) - f''(x_1)\big)$
\item[13:] \texttt{if $(\beta \leq 6)$ then return $\alpha > - (\beta + 2) / 2$}
\item[14:] \texttt{else return $\gamma > -2 \sqrt{\beta - 2}$ }

\end{itemize}
\hrule
\vspace{10pt}
%% ----------------------------------------------------------------------


%% ----------------------------------------------------------------------
Given the same initial conditions there are special circumstances which allow for the usage of simpler monotonicity conditions. In this case, consider when the quintic function has either $f'(x_0) = 0$ or $f'(x_1) = 0$, which can be tested for monotonicity via the cubic positivity conditions established by \cite{schmidt1988positivity}.

\vspace{10pt}
\hrule
\vspace{3pt}
\noindent\textbf{\textit{Algorithm 1b:}} \texttt{is\_monotone\_simplified}
\vspace{3pt}
\hrule
\begin{itemize}
  \itemsep0pt
  \parskip0pt

\item[0:] $\alpha = 30 - \frac{(x_1 - x_0)\big( 14 f'(x_0) + 16 f'(x_1) - \big(f''(x_1) - f''(x_0) \big) (x_1 - x_0)\big)}{2\big(f(x_1) - f(x_0)\big)}$
\item[1:] $\beta = 30 - \frac{(x_1 - x_0)\big( 2 f'(x_0) + 24 f'(x_1) - \big(f''(x_0) + 3 f''(x_1) \big) (x_1 - x_0)\big)}{2\big(f(x_1) - f(x_0)\big)}$
\item[2:] $\gamma = \frac{(x_1 - x_0)\big( 7 f'(x_0) + f''(x_0) (x_1 - x_0) \big)}{f(x_1) - f(x_0)}$
\item[3:] $\delta = \frac{f'(x_0) (x_1 - x_0)}{f(x_1) - f(x_0)}$

  \begin{itemize}
    \item[] \textit{The variables above are algebraic expansions of the coefficients for the cubic derivative function in \cite{schmidt1988positivity}.}
  \end{itemize}

\item[4:] \texttt{if $\big($min$(\alpha, \delta) < 0\big)$ return FALSE}
\item[5:] \texttt{else if $\big(\beta < \alpha - 2 \sqrt{\alpha \delta}\big)$ return FALSE}
\item[6:] \texttt{else if $\big(\gamma < \delta - 2 \sqrt{\alpha \delta}\big)$ return FALSE}
\item[7:] \texttt{else return TRUE}

\end{itemize}
\hrule
\vspace{10pt}
%% ----------------------------------------------------------------------

Next the modification of a quintic spline to enforce monotonicity will be discussed.

%% ----------------------------------------------------------------------
\section{Enforcing Monotonicity of a Quintic Polynomial}


\vspace{10pt}
\hrule
\vspace{3pt}
\noindent\textbf{\textit{Algorithm 2a:}} \texttt{make\_monotone}
\vspace{3pt}
\hrule

\begin{itemize}
  \itemsep0pt
  \parskip0pt

\item[0:] \texttt{if }$\big(f(x_1) - f(x_0) = 0\big)$ \texttt{ return } $f'(x_0) = f'(x_1) = f''(x_0) = f''(x_1) = 0$
\item[1:] $f'(x_0) = \ $\texttt{median}$\big(0, f'(x_0), 14 \frac{f(x_1) - f(x_0)}{x_1 - x_0} \big)$
\item[2:] $f'(x_1) = \ $\texttt{median}$\big(0, f'(x_1), 14 \frac{f(x_1) - f(x_0)}{x_1 - x_0}\big)$
  \begin{itemize}
  \item[] \textit{This selection of value for $f'(x_0)$ and $f'(x_1)$ is suggested by \cite{ulrich1994positivity} (originally from \cite{huynh1993accurate}), and quickly enforces upper and lower bounds on derivative values to allow for quintic monotonicity.}
  \end{itemize}
\item[3:] $A = f'(x_0)\frac{x_1 - x_0}{f(x_1) - f(x_0)}$
\item[4:] $B = f'(x_1) \frac{x_1 - x_0}{f(x_1) - f(x_0)}$
\item[5:] \texttt{if }$AB \leq 0$\texttt{ return make\_monotone\_simplified}
\item[6:] \texttt{if $\big($max}$(A,B) > 6\big)$\\$f'(x_0) = 6 f'(x_0)\  /$\texttt{ max}$(A,B)$\\$f'(x_1) = 6 f'(x_1)\  /$\texttt{ max}$(A,B)$

  \begin{itemize}
  \item[] \textit{This simple box bound ensures that $(A,B)$ remains within a viable region of monotonicity (satisfying Theorem 4, seen in Fig. 6 of \cite{ulrich1994positivity}).}
  \end{itemize}

\item[7:] $\hat f''(x_0) = - \sqrt{A} \big( 7 \sqrt{A} + 3 \sqrt{B} \big) \frac{f(x_1) - f(x_0)}{(x_1 - x_0)^2}$\\$\hat f''(x_1) = \sqrt{B} \big( 3 \sqrt{A} + 7 \sqrt{B} \big) \frac{f(x_1) - f(x_0)}{(x_1 - x_0)^2}$

  \begin{itemize}
    \item[] \textit{This selection of values of $f''$ is guaranteed to satisfy Theorem 4 from \cite{ulrich1994positivity} and is chosen because it is (reasonably) the average of the two endpoints of the interval of monotonicity for second derivative values.}
  \end{itemize}

\item[8:] $\eta = \big(f''(x_0), f''(x_1)\big)$\\$\eta_0 = \big(\hat f''(x_0), f''(x_1)\big)$\\$f''(x_0), f''(x_1) = $\texttt{ line\_search$\big($is\_monotone, $\eta,$ $\eta_0\big)$}
\end{itemize}
\hrule
\vspace{10pt}
%% ----------------------------------------------------------------------


Similar to the simplified check for monotonicity, when the derivative value at one endpoint of the interval is $0$, a simplified set of steps can be taken to enforce monotonicity.

%% ----------------------------------------------------------------------
\vspace{10pt}
\hrule
\vspace{3pt}
\noindent\textbf{\textit{Algorithm 2b:}} \texttt{make\_monotone\_simplified}
\vspace{3pt}
\hrule

\begin{itemize}
  \itemsep0pt
  \parskip0pt

\item[0:] $f''(x_0) = $\texttt{max}$\bigg(f''(x_0), \frac{-6 f'(x_0)}{x_1 - x_0}\bigg)$

  \begin{itemize}
    \item[] \textit{Considering the $\alpha,$ $\gamma,$ $\beta,$ and $\delta$ defined in \cite{schmidt1988positivity}, this first step enforces $\gamma > \delta.$ It is already guaranteed that $\delta = \frac{f'(x_0)(x_1 - x_0)}{f(x_1) - f(x_0)} > 0.$ Only two conditions remain to guarantee monotonicity.}
  \end{itemize}

\item[1:] $f''(x_1) = $max$\bigg( f''(x_1), f''(x_0) + \frac{14 f'(x_0) + 16 f'(x_1) + 60(f(x_1) - f(x_0)) / (x_1 - x_0)}{x_1 - x_0} \bigg)$

  \begin{itemize}
    \item[] \textit{Now it is guaranteed that $\alpha \geq 0.$}
  \end{itemize}

\item[2:] $f''(x_1) = $max$\bigg( f''(x_1), 6 f'(x_0) - 4 f'(x_1) - f''(x_0) \bigg)$

  \begin{itemize}
    \item[] \textit{Lastly, this guarantees that $\beta \geq \alpha.$ All conditions are met to satisfy proposition 2 of \cite{schmidt1988positivity} and ensure monotonicity.}
  \end{itemize}
\end{itemize}
\hrule
\vspace{10pt}
%% ----------------------------------------------------------------------



%% ----------------------------------------------------------------------
\section{Constructing a Piecewise Quintic Monotone Spline}
\label{monotone_spline}

Finally, the construction of a full piecewise quintic spline is outlined using the above algorithms.

Let $f: \mathbb{R} \rightarrow \mathbb{R}$ be a function in $\mathcal{C}^2.$ Proceed given evaluation tuples $\big(x_i,$ $f(x_i),$ $f'(x_i),$ $f''(x_i)\big)$ for $i = 0,\ldots,N$ such that $x_i < x_{i+1}$ and (without loss of generality) $f(x_i) \leq f(x_{i+1})$ for $i = 1,$ $\ldots,$ $N-1$. 

\vspace{10pt}
\hrule
\vspace{3pt}
\noindent\textbf{\textit{Algorithm 3:}} \texttt{monotone\_spline}
\vspace{3pt}
\hrule

\begin{itemize}
  \itemsep0pt
  \parskip0pt

\item Compute
\end{itemize}
%% ----------------------------------------------------------------------




\bibliographystyle{spmpsci}
\bibliography{pqmip}

\end{document}
